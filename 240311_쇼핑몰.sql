CREATE TABLE CATEGORIES( -- 카테고리 테이블
	CATEGORY_ID NUMBER PRIMARY KEY,
	CATEGORY_NAME VARCHAR2(100) UNIQUE
);

COMMENT ON COLUMN CATEGORIES.CATEGORY_ID IS '카테고리 ID';
COMMENT ON COLUMN CATEGORIES.CATEGORY_NAME IS '카테고리 이름';

INSERT INTO CATEGORIES VALUES (1, '스마트폰');
INSERT INTO CATEGORIES VALUES (2, 'TV');
INSERT INTO CATEGORIES VALUES (3, 'GAMING');

--─────────────────────────────────────────────────────────────────────────────────────────────────
--─────────────────────────────────────────────────────────────────────────────────────────────────


CREATE TABLE PRODUCTS( -- 상품정보 테이블
	PRODUCT_ID NUMBER PRIMARY KEY,
	PRODUCT_NAME VARCHAR2(100) NOT NULL,
	CATEGORY NUMBER,
	PRICE NUMBER DEFAULT 0,
	STOCK_QUANTITY NUMBER DEFAULT 0,
		CONSTRAINT FK_CATEGORY 
		FOREIGN KEY (CATEGORY)
		REFERENCES CATEGORIES (CATEGORY_ID)
		ON DELETE SET NULL
);

COMMENT ON COLUMN PRODUCTS.PRODUCT_ID IS '상품코드';
COMMENT ON COLUMN PRODUCTS.PRODUCT_NAME IS '상품이름';
COMMENT ON COLUMN PRODUCTS.CATEGORY IS '카테고리';
COMMENT ON COLUMN PRODUCTS.PRICE IS '가격';
COMMENT ON COLUMN PRODUCTS.STOCK_QUANTITY IS '재고량';

INSERT INTO PRODUCTS VALUES (101, 'Apple iPhone 12', 1, 1500000, 30);
INSERT INTO PRODUCTS VALUES (102, 'Samsung Galaxy S24', 1, 1800000, 50);
INSERT INTO PRODUCTS VALUES (201, 'LG OLED TV', 2 ,3600000, 10);
INSERT INTO PRODUCTS VALUES (301, 'Sony PlayStation 5', 3, 700000, 15);


--─────────────────────────────────────────────────────────────────────────────────────────────────
--─────────────────────────────────────────────────────────────────────────────────────────────────


CREATE TABLE CUSTOMERS ( -- 고객 정보 테이블
	CUSTOMER_ID NUMBER PRIMARY KEY,
	NAME VARCHAR2(20) NOT NULL,
	GENDER CHAR(3) CONSTRAINT GENDER_CHECK CHECK(GENDER IN('남','여')),
	ADDRESS VARCHAR2(100),
	PHONE VARCHAR2(30)
);

COMMENT ON COLUMN CUSTOMERS.CUSTOMER_ID IS '고객 ID';
COMMENT ON COLUMN CUSTOMERS.NAME IS '이름';
COMMENT ON COLUMN CUSTOMERS.GENDER IS '성별';
COMMENT ON COLUMN CUSTOMERS.ADDRESS IS '주소';
COMMENT ON COLUMN CUSTOMERS.PHONE IS '전화번호';

INSERT INTO CUSTOMERS VALUES (1, '홍길동', '남', '서울시 성동구 왕십리', '010-1111-2222');
INSERT INTO CUSTOMERS VALUES (2, '유관순', '여', '서울시 종로구 안국동', '010-3333-1111');

--─────────────────────────────────────────────────────────────────────────────────────────────────
--─────────────────────────────────────────────────────────────────────────────────────────────────

CREATE TABLE ORDERS(-- 주문 정보 테이블
	ORDER_ID NUMBER PRIMARY KEY,
	CUSTOMER_ID NUMBER,
	STATUS CHAR(1) CONSTRAINT STATUS_CHECK CHECK(STATUS IN('Y','N') ),
	ORDER_DATE DATE DEFAULT SYSDATE,
		CONSTRAINT CUSTOMER_ID_FK
		FOREIGN KEY (CUSTOMER_ID)
		REFERENCES CUSTOMERS (CUSTOMER_ID)
		ON DELETE CASCADE
);

--ALTER TABLE ORDERS ADD (ORDER_DATE DATE);
--ALTER TABLE ORDERS MODIFY ORDER_DATE DEFAULT SYSDATE;

COMMENT ON COLUMN ORDERS.ORDER_ID IS '주문 번호';
COMMENT ON COLUMN ORDERS.CUSTOMER_ID IS '고객 ID';
COMMENT ON COLUMN ORDERS.ORDER_DATE IS '처리상태';
COMMENT ON COLUMN ORDERS.STATUS IS '주문일';

ALTER TABLE ORDERS MODIFY STATUS DEFAULT 'N';

INSERT INTO ORDERS VALUES(576, 1, 'N', TO_DATE('2024-02-29') );
INSERT INTO ORDERS VALUES(978, 2, 'Y', TO_DATE('2024-03-11') );
INSERT INTO ORDERS VALUES(777, 2, 'N', TO_DATE('2024-03-11') );
INSERT INTO ORDERS VALUES(134, 1, 'Y', TO_DATE('2024-12-25') );
INSERT INTO ORDERS VALUES(499, 1, 'Y', TO_DATE('2024-01-03') );


SELECT * FROM ORDERS;
ROLLBACK;
--─────────────────────────────────────────────────────────────────────────────────────────────────
--─────────────────────────────────────────────────────────────────────────────────────────────────


CREATE TABLE ORDER_DETAILS(-- 주문 상세정보 테이블
	ORDER_DETAIL_ID NUMBER PRIMARY KEY,
	ORDER_ID NUMBER,
	PRODUCT_ID NUMBER,
	QUANTITY NUMBER,
	PRICE_PER_UNIT NUMBER,
	CONSTRAINT ORDER_ID_FK
  FOREIGN KEY (ORDER_ID)
	REFERENCES ORDERS (ORDER_ID)
	ON DELETE SET NULL,
									
	CONSTRAINT PRODUCT_ID_FK
	FOREIGN KEY (PRODUCT_ID)
	REFERENCES PRODUCTS (PRODUCT_ID)
	ON DELETE SET NULL
	);


COMMENT ON COLUMN ORDER_DETAILS.ORDER_DETAIL_ID IS '주문 상세 ID';
COMMENT ON COLUMN ORDER_DETAILS.ORDER_ID IS '주문 번호';
COMMENT ON COLUMN ORDER_DETAILS.PRODUCT_ID IS '상품 코드';
COMMENT ON COLUMN ORDER_DETAILS.QUANTITY IS '수량';
COMMENT ON COLUMN ORDER_DETAILS.PRICE_PER_UNIT IS '가격';

INSERT INTO ORDER_DETAILS VALUES(111, 576, 101, 1, 1500000 );
INSERT INTO ORDER_DETAILS VALUES(222, 978, 201, 2, 3600000 );
INSERT INTO ORDER_DETAILS VALUES(333, 978, 102, 1, 1800000 );
INSERT INTO ORDER_DETAILS VALUES(444, 777, 301, 5, 700000 );
INSERT INTO ORDER_DETAILS VALUES(555, 134, 102, 1, 1800000 );
INSERT INTO ORDER_DETAILS VALUES(666, 499, 201, 3, 3600000 );

	
ROLLBACK;
SELECT * FROM ORDER_DETAILS;



SELECT NAME, STATUS, ORDER_DATE
FROM CUSTOMERS 
JOIN ORDERS USING();
